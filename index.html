<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เครื่องมือคำนวณหนี้อเนกประสงค์</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .shadow-custom {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Custom scrollbar for table */
        #amortizationTableContainer::-webkit-scrollbar {
            height: 8px;
        }
        #amortizationTableContainer::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        #amortizationTableContainer::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-blue-800 mb-2">คำนวณหนี้</h1>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Input Panel -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-custom h-full">
                <h2 class="text-2xl font-semibold mb-6 text-blue-700">ข้อมูลการกู้ยืม</h2>
                <form id="debtForm" class="space-y-4">
                    <!-- เงินต้น -->
                    <div>
                        <label for="principal" class="block text-sm font-medium text-gray-700">เงินต้น (บาท)</label>
                        <input type="number" id="principal" value="10000" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition duration-150" required min="1">
                    </div>

                    <!-- อัตราดอกเบี้ย -->
<div class="space-y-1">
    <label class="block text-sm font-medium text-gray-700">อัตราดอกเบี้ย (%)</label>
    <div class="flex space-x-2">
        <select id="rateBasis" class="mt-1 block w-2/5 rounded-lg border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            <option value="periodic"selected>ร้อยละ</option>
            <option value="annual">ต่อปี</option>
        </select>
        <input type="number" id="rate" value="20" class="mt-1 block w-3/5 rounded-lg border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition duration-150" required min="0">
    </div>
    <p id="rateHint" class="text-xs text-gray-500 mt-1">อัตราดอกเบี้ยต่อปี</p>
</div>

                    <!-- ระยะเวลาผ่อนชำระ -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label for="term" class="block text-sm font-medium text-gray-700">ระยะเวลา (งวด)</label>
                            <input type="number" id="term" value="3" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition duration-150" required min="1">
                        </div>
                        <div>
                            <label for="termUnit" class="block text-sm font-medium text-gray-700">หน่วยงวด</label>
                            <select id="termUnit" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                                <option value="year">ปี</option>
                                <option value="month" selected>เดือน</option>
                                <option value="day">วัน (รายวัน)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ประเภทดอกเบี้ย -->
                    <div class="space-y-3 pt-2">
                        <label class="block text-sm font-medium text-gray-700">วิธีการคิดดอกเบี้ย</label>
                        <div class="flex items-center space-x-6">
                            <label class="inline-flex items-center">
                                <input type="radio" name="interestType" value="reducing" checked class="form-radio h-5 w-5 text-blue-600">
                                <span class="ml-2 text-gray-700">ลดต้นลดดอก</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="interestType" value="flat" class="form-radio h-5 w-5 text-blue-600">
                                <span class="ml-2 text-gray-700">ดอกเบี้ยคงที่</span>
                            </label>
                        </div>
                    </div>

                    <!-- การกำหนดเงินต้นต่องวด (NEW FEATURE) -->
                    <div class="space-y-3 pt-2 bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <label class="block text-sm font-bold text-gray-700">การกำหนดเงินต้นต่องวด</label>
                        <div class="space-y-2">
                            <label class="inline-flex items-center">
                                <input type="radio" name="principalMode" value="auto" checked class="form-radio h-5 w-5 text-purple-600">
                                <span class="ml-2 text-gray-700">อัตโนมัติ (หารเท่า)</span>
                            </label>
                            <label class="inline-flex items-center block">
                                <input type="radio" name="principalMode" value="increasing" class="form-radio h-5 w-5 text-purple-600">
                                <span class="ml-2 text-gray-700">เงินต้นเพิ่ม</span>
                            </label>
                            <label class="inline-flex items-center block">
                                <input type="radio" name="principalMode" value="manual" class="form-radio h-5 w-5 text-purple-600">
                                <span class="ml-2 text-gray-700">กำหนดเอง</span>
                            </label>
                        </div>
                        
                        <!-- Dynamic Input Container for Manual Mode -->
                        <div id="principalInputsContainer" class="space-y-2 mt-4 hidden">
                            <p class="text-sm text-gray-500 mb-2">ระบุยอดเงินต้นที่ต้องการผ่อนชำระในแต่ละงวด:</p>
                        </div>
                        <p id="principalSumWarning" class="text-lg font-extrabold text-red-600 p-2 rounded-lg bg-red-100 hidden"></p>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-blue-300 mt-6">
                        คำนวณ
                    </button>
                </form>
            </div>

            <!-- Result Panel -->
            <div class="lg:col-span-2 space-y-8">
                <div id="resultSummary" class="bg-white p-6 rounded-xl shadow-custom">
                    <h2 class="text-2xl font-semibold mb-4 text-green-700">สรุปผลการคำนวณ</h2>
                    <div id="initialMessage" class="text-gray-500">กรุณากรอกข้อมูลและกดปุ่ม "คำนวณหนี้" เพื่อดูผลลัพธ์</div>

                    <div id="calculationResult" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <p class="text-sm text-gray-600">เฉลี่ยต่องวด</p>
                            <p id="monthlyPayment" class="text-2xl font-bold text-blue-900 mt-1">0.00</p>
                            <p id="paymentUnit" class="text-xs text-gray-500"></p>
                        </div>
                        <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                            <p class="text-sm text-gray-600">ดอกเบี้ยรวม</p>
                            <p id="totalInterest" class="text-2xl font-bold text-red-700 mt-1">0.00</p>
                            <p class="text-xs text-gray-500">บาท</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <p class="text-sm text-gray-600">ยอดรวมชำระ</p>
                            <p id="totalRepayment" class="text-2xl font-bold text-green-700 mt-1">0.00</p>
                            <p class="text-xs text-gray-500">บาท</p>
                        </div>
                    </div>
                </div>

                <!-- Amortization Table -->
                <div id="amortizationSection" class="bg-white p-6 rounded-xl shadow-custom hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-700">ตารางการผ่อนชำระ</h2>
                    <div id="amortizationTableContainer" class="overflow-x-auto max-h-96">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">งวดที่</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">เงินต้นคงเหลือ (เริ่มต้น)</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ยอดผ่อนต่องวด</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ดอกเบี้ย</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">เงินต้น</th>
                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">เงินต้นคงเหลือ (สิ้นสุด)</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Constants for rate conversion
        const DAYS_IN_YEAR = 365;
        const MONTHS_IN_YEAR = 12;

        // Global array to store user-defined or auto-calculated principal repayment per period
        let principalSchedule = [];
        // Global object to temporarily store manual inputs when switching modes
        let manualPrincipalValues = {};

        // Utility function to format number to Thai baht style (2 decimal places)
        const formatBaht = (amount) => {
            if (!isFinite(amount)) return '0.00';
            // Round to 2 decimal places before formatting to prevent display of very small float artifacts
            const roundedAmount = Math.round(amount * 100) / 100;
            return new Intl.NumberFormat('th-TH', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            }).format(roundedAmount);
        };

        // Utility function to get the number of periods per year based on the unit
        const getPeriodsPerYear = (termUnit) => {
            if (termUnit === 'year') return 1;
            if (termUnit === 'month') return MONTHS_IN_YEAR;
            if (termUnit === 'day') return DAYS_IN_YEAR;
            return 12; 
        };
        
        // Utility function to update the rate hint message
        const updateRateHint = () => {
            const rateBasis = document.getElementById('rateBasis').value;
            const termUnit = document.getElementById('termUnit').value;
            const hintElement = document.getElementById('rateHint');

            if (rateBasis === 'annual') {
                hintElement.textContent = `อัตราดอกเบี้ยต่อปี`;
            } else {
                let unitText = '';
                if (termUnit === 'year') unitText = 'ปี';
                else if (termUnit === 'month') unitText = 'เดือน';
                else if (termUnit === 'day') unitText = 'วัน';
                
                hintElement.textContent = `อัตราดอกเบี้ยต่องวด (${unitText})`;
            }
        };

        // --- PRINCIPAL SCHEDULE MANAGEMENT ---

        // Function to only validate the principal sum (NO rendering here)
        const validatePrincipalSum = () => {
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const term = parseInt(document.getElementById('term').value, 10) || 0;
            const principalMode = document.querySelector('input[name="principalMode"]:checked').value;
            const warningElement = document.getElementById('principalSumWarning');
            warningElement.classList.add('hidden'); // Hide by default

            if (principal <= 0 || term <= 0) {
                principalSchedule = [];
                return;
            }

            if (principalMode === 'auto') {
                // Mode 1: Automatic - Equal installments
                const fixedPrincipal = principal / term;
                principalSchedule = Array(term).fill(fixedPrincipal);

            } else { // 'manual' or 'increasing'
                // Read from inputs
                const inputs = Array.from(document.querySelectorAll('.principal-input'));
                
                // Read values, ensure they are numbers
                const manualPrincipals = inputs.map(input => parseFloat(input.value) || 0);
                const sumPrincipals = manualPrincipals.reduce((sum, val) => sum + val, 0);
                
                // Store/Set the global schedule
                principalSchedule = manualPrincipals;

                // Validation check: Use a small tolerance for float comparison (e.g., 0.01 Baht)
                const tolerance = 0.01;
                if (Math.abs(sumPrincipals - principal) > tolerance) { 
                    warningElement.classList.remove('hidden');
                    const diff = sumPrincipals - principal;
                    if (diff > 0) {
                        warningElement.textContent = `⚠️ ยอดเงินต้นรวมเกิน (${formatBaht(principal)} บาท) อยู่ ${formatBaht(diff)} บาท กรุณาปรับแก้`;
                    } else {
                        warningElement.textContent = `⚠️ ยอดเงินต้นรวมขาด (${formatBaht(principal)} บาท) อยู่ ${formatBaht(Math.abs(diff))} บาท กรุณาปรับแก้`;
                    }
                }
            }
        };

        // Function to update the dynamic principal input fields (Manual/Increasing mode)
        const updatePrincipalInputs = () => {
            const term = parseInt(document.getElementById('term').value, 10) || 0;
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const principalMode = document.querySelector('input[name="principalMode"]:checked').value;
            const container = document.getElementById('principalInputsContainer');
            
            // 1. Save current manual values before clearing (for 'manual' mode memory)
            if (principalMode !== 'manual') {
                const currentInputs = document.querySelectorAll('.principal-input');
                currentInputs.forEach(input => {
                    manualPrincipalValues[input.dataset.period] = input.value;
                });
            }

            // Clear previous content
            container.innerHTML = '<p class="text-sm text-gray-500 mb-2">ระบุยอดเงินต้นที่ต้องการผ่อนชำระในแต่ละงวด:</p>';
            
            if (principalMode === 'manual' || principalMode === 'increasing') {
                container.classList.remove('hidden');

                if (term <= 0 || principal <= 0) {
                     container.innerHTML = '<p class="text-sm text-red-500 mb-2">กรุณาระบุเงินต้นและระยะเวลา (งวด) ที่ถูกต้อง</p>';
                     return;
                }
                
                let valuesToPreFill = [];

                if (principalMode === 'increasing') {
                    // Logic for Fixed Payment Simulation (Increasing Principal Component)
                    // Use Arithmetic Progression: P1 = 0.5*P_avg, PN = 1.5*P_avg
                    const P_avg = principal / term;
                    
                    // If N=1, P1 must equal P.
                    if (term === 1) {
                         valuesToPreFill = [principal];
                    } else {
                        const P_first = 0.5 * P_avg; // Start at 50% of average
                        const P_last = 1.5 * P_avg;  // End at 150% of average
                        // Common difference 'd'
                        const d = (P_last - P_first) / (term - 1);

                        for (let i = 1; i <= term; i++) {
                            const P_i = P_first + (i - 1) * d;
                            valuesToPreFill.push(P_i);
                        }
                        
                        // Recalculate and adjust the last payment to ensure sum is exactly 'principal' due to float precision
                        const currentSum = valuesToPreFill.reduce((sum, val) => sum + val, 0);
                        const adjustment = principal - currentSum;
                        if (term > 0) {
                            valuesToPreFill[term - 1] = valuesToPreFill[term - 1] + adjustment;
                        }
                    }

                } else if (principalMode === 'manual') {
                    // Manual (Free Form): Try to retrieve remembered values, otherwise use equal split
                    const P_avg = principal / term;
                    for (let i = 1; i <= term; i++) {
                        const rememberedValue = manualPrincipalValues[i];
                        if (rememberedValue !== undefined && !isNaN(parseFloat(rememberedValue))) {
                            valuesToPreFill.push(parseFloat(rememberedValue));
                        } else {
                            valuesToPreFill.push(P_avg); // Default to auto if no memory
                        }
                    }
                }
                
                // Render the input fields
                for (let i = 1; i <= term; i++) {
                    const inputValue = valuesToPreFill[i - 1] !== undefined ? valuesToPreFill[i - 1].toFixed(2) : (principal / term).toFixed(2);

                    const inputGroup = document.createElement('div');
                    inputGroup.className = 'flex items-center space-x-2';
                    inputGroup.innerHTML = `
                        <label class="text-sm text-gray-600 w-12 shrink-0">งวดที่ ${i}</label>
                        <input type="number" 
                               data-period="${i}" 
                               value="${inputValue}" 
                               min="0"
                               step="0.01"
                               class="principal-input mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 text-sm focus:ring-purple-500 focus:border-purple-500"
                               oninput="validatePrincipalSum(); calculateDebtAndRender();">
                    `;
                    container.appendChild(inputGroup);
                }
            } else {
                container.classList.add('hidden');
            }
        };

        // --- CALCULATION LOGIC ---

        const calculateDebt = () => {
            const principal = parseFloat(document.getElementById('principal').value);
            const rateInput = parseFloat(document.getElementById('rate').value); 
            const rateBasis = document.getElementById('rateBasis').value; 
            const termUnit = document.getElementById('termUnit').value;
            const interestType = document.querySelector('input[name="interestType"]:checked').value;

            // Input Validation & check if principalSchedule is ready
            if (isNaN(principal) || principal <= 0 || isNaN(rateInput) || principalSchedule.length === 0) {
                return { totalInterest: 0, totalRepayment: principal, periodicPayment: 0, schedule: [], paymentUnit: '' };
            }

            const totalPeriods = principalSchedule.length;
            const periodsPerYear = getPeriodsPerYear(termUnit);
            let periodicRate = 0; // Periodic rate in decimal

            if (rateBasis === 'annual') {
                periodicRate = (rateInput / 100) / periodsPerYear;
            } else { // rateBasis === 'periodic'
                periodicRate = rateInput / 100;
            }

            // Check for critical validation error (if in manual mode and sum is wrong)
            const hasPrincipalError = !document.getElementById('principalSumWarning').classList.contains('hidden');
            if (hasPrincipalError) {
                return { totalInterest: 0, totalRepayment: principal, periodicPayment: 0, schedule: [], paymentUnit: '' };
            }

            let remainingPrincipal = principal;
            let totalInterestPaid = 0;
            let schedule = [];

            const paymentUnitText = termUnit === 'year' ? 'บาท/ปี' : termUnit === 'month' ? 'บาท/เดือน' : 'บาท/วัน';
            
            // --- Core Calculation Loop ---
            
            for (let i = 1; i <= totalPeriods; i++) {
                const principalStart = remainingPrincipal;
                
                // 1. Determine Principal Repayment for this period
                let principalPayment = principalSchedule[i - 1] || 0; 
                
                // Safety check for the final payment against remaining principal
                if (principalStart < principalPayment && i === totalPeriods) {
                    principalPayment = principalStart;
                }

                // 2. Calculate Interest Payment
                let interestPayment = 0;

                if (interestType === 'flat') {
                    // Flat Rate: Interest is calculated on the initial principal
                    let actualPeriodicRate;
                    if (rateBasis === 'periodic') {
                        actualPeriodicRate = periodicRate; 
                    } else {
                        actualPeriodicRate = (rateInput / 100) / periodsPerYear;
                    }
                    
                    const totalInterest = principal * actualPeriodicRate * totalPeriods;
                    interestPayment = totalInterest / totalPeriods; // Fixed interest amount per period

                } else { // 'reducing' (ลดต้นลดดอก)
                    // Reducing Balance: Interest is calculated based on the remaining principal
                    interestPayment = principalStart * periodicRate;
                }
                
                interestPayment = Math.max(0, interestPayment);

                // 3. Calculate Total Payment
                let periodicPayment = principalPayment + interestPayment;
                
                // 4. Update Remaining Principal
                remainingPrincipal -= principalPayment;
                if (remainingPrincipal < 0) remainingPrincipal = 0;

                totalInterestPaid += interestPayment;

                schedule.push({
                    period: i,
                    principalStart: principalStart,
                    payment: periodicPayment,
                    interest: interestPayment,
                    principal: principalPayment,
                    principalEnd: remainingPrincipal,
                });
                
                // Break loop if loan is fully paid off (using float tolerance)
                if (principalStart > 0 && Math.abs(remainingPrincipal) < 0.005) { 
                     break; 
                }
            }

            const totalRepaymentAmount = principal + totalInterestPaid;
            
            // Average periodic payment (actual payment varies)
            const averagePeriodicPayment = schedule.length > 0 ? totalRepaymentAmount / schedule.length : 0;


            return { 
                totalInterest: totalInterestPaid, 
                totalRepayment: totalRepaymentAmount, 
                periodicPayment: averagePeriodicPayment, 
                schedule: schedule,
                paymentUnit: paymentUnitText
            };
        };

        // --- RENDER LOGIC ---

        const renderResults = (results) => {
            const { totalInterest, totalRepayment, periodicPayment, schedule, paymentUnit } = results;

            // Check if calculation failed due to principal error or incomplete data
            const hasError = schedule.length === 0 || totalRepayment === 0 || !document.getElementById('principalSumWarning').classList.contains('hidden');

            if (hasError) {
                document.getElementById('initialMessage').classList.remove('hidden');
                document.getElementById('calculationResult').classList.add('hidden');
                document.getElementById('amortizationSection').classList.add('hidden');
                return;
            }

            document.getElementById('monthlyPayment').textContent = formatBaht(periodicPayment);
            document.getElementById('totalInterest').textContent = formatBaht(totalInterest);
            document.getElementById('totalRepayment').textContent = formatBaht(totalRepayment);
            document.getElementById('paymentUnit').textContent = paymentUnit + ' (เฉลี่ย)'; 

            document.getElementById('initialMessage').classList.add('hidden');
            document.getElementById('calculationResult').classList.remove('hidden');
            document.getElementById('amortizationSection').classList.remove('hidden');

            const tableBody = document.getElementById('amortizationTableBody');
            tableBody.innerHTML = ''; // Clear previous table

            schedule.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 transition duration-100';
                tr.innerHTML = `
                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${row.period}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 text-right">${formatBaht(row.principalStart)}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-blue-600 font-semibold text-right">${formatBaht(row.payment)}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-red-600 text-right">${formatBaht(row.interest)}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm text-green-600 text-right">${formatBaht(row.principal)}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-700 text-right">${formatBaht(row.principalEnd)}</td>
                `;
                tableBody.appendChild(tr);
            });
        };

        // Consolidated function to calculate and render results
        const calculateDebtAndRender = () => {
             // 1. Validate principal schedule and update global schedule/warning
             validatePrincipalSum(); 
             // 2. Run calculation and get results
             const results = calculateDebt();
             // 3. Render results
             renderResults(results);
        };

        // --- EVENT HANDLERS ---

        document.getElementById('debtForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateDebtAndRender();
        });

        document.addEventListener('DOMContentLoaded', () => {
            updateRateHint(); 
            
            // CORE INPUT LISTENERS
            const coreInputs = [
                'principal', 'term', 'rate', 'rateBasis', 'termUnit'
            ];

            coreInputs.forEach(id => {
                const el = document.getElementById(id);
                el.addEventListener('input', () => {
                    // Update manual inputs if principal or term changes, then re-calculate
                    if (id === 'principal' || id === 'term') {
                        // For principal/term change, check the current mode and update
                        const currentMode = document.querySelector('input[name="principalMode"]:checked').value;
                        if (currentMode === 'increasing' || currentMode === 'manual') {
                             updatePrincipalInputs(); 
                        }
                    }
                    if (id === 'rateBasis' || id === 'termUnit') {
                        updateRateHint(); 
                    }
                    calculateDebtAndRender();
                });
            });

            // LISTENERS FOR RADIO BUTTONS (INTEREST TYPE & PRINCIPAL MODE)
            document.querySelectorAll('input[name="interestType"]').forEach(radio => {
                radio.addEventListener('change', calculateDebtAndRender);
            });

            document.querySelectorAll('input[name="principalMode"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    updatePrincipalInputs(); // Show/Hide/Pre-fill manual inputs
                    calculateDebtAndRender(); 
                });
            });

            // Initial setup and calculation
            updatePrincipalInputs(); 
            calculateDebtAndRender();
        });
    </script>
</body>
</html>
